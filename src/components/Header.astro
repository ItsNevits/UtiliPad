---
import UtiliPadIcon from "@/assets/icons/favicon.png";
import LanguageToggle from "./LanguageToggle.astro";

import { Picture } from "astro:assets";
import type { Language } from "@/types/language.type";
import { getTranslation } from "@/i18n/index";

const lang = Astro.params.lang as Language;
const currentPath = Astro.url.pathname;
---

<header class="select-none mb-4 md:mb-10">
  <div class="px-9 py-6">
    <!-- Desktop and Mobile Layout -->
    <div class="flex items-center justify-between gap-3">
      <!-- Logo -->
      <a
        title={getTranslation(lang, "components.header.title")}
        href={`/${lang}`}
        class="flex items-center gap-2.5 mr-2 flex-shrink-0"
      >
        <div
          class="h-9 w-9 rounded-full bg-white border border-black/20 grid place-items-center"
        >
          <Picture
            src={UtiliPadIcon}
            alt="UtiliPad logo"
            class="p-0.5"
            width={22}
            height={22}
            loading={"lazy"}
            formats={["avif", "webp", "png"]}
          />
        </div>
        <h1 class="font-semibold text-lg hidden sm:inline text-neutral-800">
          UtiliPad
        </h1>
      </a>

      <!-- Desktop Navigation -->
      <nav class="hidden md:block flex-shrink-0">
        <ul class="flex gap-6">
          <li>
            <a
              href={`/${lang}/tools`}
              class={`text-black font-medium border-b-2 hover:border-b-emerald-600 transition-colors whitespace-nowrap ${
                currentPath.startsWith(`/${lang}/tools`)
                  ? "border-b-emerald-600"
                  : "border-b-transparent"
              }`}>Herramientas</a
            >
          </li>
          <li>
            <a
              href={`/${lang}/about`}
              class={`text-black font-medium border-b-2 hover:border-b-emerald-600 transition-colors whitespace-nowrap ${
                currentPath.startsWith(`/${lang}/about`)
                  ? "border-b-emerald-600"
                  : "border-b-transparent"
              }`}>{lang === "es" ? "Conócenos" : "About Us"}</a
            >
          </li>
          <li>
            <a
              href={`/${lang}/news`}
              class={`text-black font-medium border-b-2 hover:border-b-emerald-600 transition-colors whitespace-nowrap ${
                currentPath.startsWith(`/${lang}/news`)
                  ? "border-b-emerald-600"
                  : "border-b-transparent"
              }`}>{lang === "es" ? "Novedades" : "News"}</a
            >
          </li>
        </ul>
      </nav>

      <!-- Language Toggle -->
      <div class="hidden sm:block flex-shrink-0">
        <LanguageToggle />
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-button"
        class="md:hidden ml-auto p-2 text-neutral-400 hover:text-white transition-colors"
        aria-label="Toggle menu"
      >
        <svg
          id="menu-icon"
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
        <svg
          id="close-icon"
          class="w-6 h-6 hidden"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Mobile Menu -->
    <div
      id="mobile-menu"
      class="md:hidden hidden overflow-hidden transition-all duration-300"
    >
      <nav class="pt-4 pb-2 space-y-3">
        <!-- Mobile Navigation Links -->
        <a
          href={`/${lang}/about`}
          class="block py-2 text-neutral-700 hover:text-emerald-600 font-medium transition-colors"
          >{lang === "es" ? "Conócenos" : "About Us"}</a
        >
        <a
          href={`/${lang}/news`}
          class="block py-2 text-neutral-700 hover:text-emerald-600 font-medium transition-colors"
          >{lang === "es" ? "Novedades" : "News"}</a
        >

        <!-- Mobile Language Toggle -->
        <div class="sm:hidden pt-2 border-t border-neutral-800">
          <LanguageToggle />
        </div>
      </nav>
    </div>
  </div>
</header>

<script>
  const initSearchShortcut = () => {
    const isMac = navigator.userAgent.indexOf("Mac OS X") != -1;
    document.querySelectorAll("header .shortcut").forEach((el) => {
      el.textContent = isMac ? "⌘K" : "Ctrl+K";
    });

    document.addEventListener("keydown", (e) => {
      if (
        (isMac && e.metaKey && e.key.toLowerCase() === "k") ||
        (!isMac && e.ctrlKey && e.key.toLowerCase() === "k")
      ) {
        e.preventDefault();
        const input = document.getElementById(
          "search-input"
        ) as HTMLInputElement;
        if (input) {
          input.focus();
          input.select();
        }
      }
    });
  };

  const initMobileMenu = () => {
    const menuButton = document.getElementById("mobile-menu-button");
    const mobileMenu = document.getElementById("mobile-menu");
    const menuIcon = document.getElementById("menu-icon");
    const closeIcon = document.getElementById("close-icon");

    if (!menuButton || !mobileMenu || !menuIcon || !closeIcon) return;

    menuButton.addEventListener("click", () => {
      const isHidden = mobileMenu.classList.contains("hidden");

      if (isHidden) {
        // Show menu
        mobileMenu.classList.remove("hidden");
        menuIcon.classList.add("hidden");
        closeIcon.classList.remove("hidden");
      } else {
        // Hide menu
        mobileMenu.classList.add("hidden");
        menuIcon.classList.remove("hidden");
        closeIcon.classList.add("hidden");
      }
    });

    // Close menu when clicking on a link
    const mobileLinks = mobileMenu.querySelectorAll("a");
    mobileLinks.forEach((link) => {
      link.addEventListener("click", () => {
        mobileMenu.classList.add("hidden");
        menuIcon.classList.remove("hidden");
        closeIcon.classList.add("hidden");
      });
    });
  };

  document.addEventListener("DOMContentLoaded", () => {
    initSearchShortcut();
    initMobileMenu();
  });
</script>
