---
import UtiliPadIcon from "@assets/icons/favicon.png";
import Search from "./shared/Search.astro";
import { Picture } from "astro:assets";
import LanguageToggle from "./LanguageToggle.astro";
import type { Language } from "../types/language.type";

interface Props {
  lang: Language;
  t: any;
}

const { lang, t } = Astro.props;
---

<header
  class="sticky top-0 z-20 backdrop-blur supports-[backdrop-filter]:bg-neutral-900/60 bg-neutral-900/80 border-b border-neutral-800 select-none"
>
  <div class="mx-auto max-w-7xl px-4 py-3 flex items-center gap-3">
    <a
      title={t.components.header.title}
      href={`/${lang}`}
      class="flex items-center gap-2 mr-2"
    >
      <div class="h-8 w-8 rounded-xl bg-emerald-500/20 grid place-items-center">
        <span class="text-emerald-400 font-bold">
          <Picture
            src={UtiliPadIcon}
            alt="UtiliPad logo"
            width={20}
            height={20}
            loading={"lazy"}
            formats={["avif", "webp", "png"]}
          />
        </span>
      </div>
      <span class="font-semibold tracking-tight">UtiliPad</span>
    </a>
    <div class="ml-auto flex-1 max-w-xl">
      <Search lang={lang} t={t} />
    </div>
    <LanguageToggle lang={lang} t={t} />
  </div>
</header>

<script>
  const initSearchShortcut = () => {
    const isMac = navigator.userAgent.indexOf("Mac OS X") != -1;
    document.querySelectorAll("header .shortcut").forEach((el) => {
      el.textContent = isMac ? "âŒ˜K" : "Ctrl+K";
    });

    document.addEventListener("keydown", (e) => {
      if (
        (isMac && e.metaKey && e.key.toLowerCase() === "k") ||
        (!isMac && e.ctrlKey && e.key.toLowerCase() === "k")
      ) {
        e.preventDefault();
        const input = document.getElementById(
          "search-input"
        ) as HTMLInputElement;
        if (input) {
          input.focus();
          input.select();
        }
      }
    });
  };

  document.addEventListener("DOMContentLoaded", initSearchShortcut);
</script>
