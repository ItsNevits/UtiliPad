---
export const prerender = false;
import Hero from "@/components/shared/Hero.astro";
import MainLayout from "@/Layouts/MainLayout.astro";
import BreadCrumbs from "@/components/shared/BreadCrumbs.astro";
import Footer from "@/components/Footer.astro";

import { getCollection } from "astro:content";
import type { Language } from "@/types/language.type";
import { getTranslation } from "@/i18n/index";
import Header from "@/components/Header.astro";

const lang = Astro.params.lang as Language;
const slug = Astro.params.slug;

// Obtener la entrada de manera dinámica
const news = await getCollection("news");
const normalizedSlug = `${lang}/${slug}`;
const entry = news.find((entry) => {
  const normalizedId = entry.id.replace(/\\/g, "/");
  return normalizedId === normalizedSlug;
});

if (!entry) {
  return Astro.redirect("/404");
}

const { Content } = await entry.render();
---

<MainLayout
  title={getTranslation(lang, "seo.pages.news.title")}
  description={getTranslation(lang, "seo.pages.news.description")}
>
  <div class="bg-[#dddfe0] m-4 rounded-2xl pb-10 md:pb-15">
    <Header />
    <section class="w-full max-w-7xl mx-auto flex flex-col">
      <Hero
        title={entry.data.title}
        description={`Publicado el ${entry.data.date.toLocaleDateString(
          "es-ES",
          {
            year: "numeric",
            month: "long",
            day: "numeric",
          }
        )}`}
      />
    </section>
  </div>

  <main class="max-w-7xl w-full mx-auto px-4 py-4 mb-8 md:mb-12">
    <BreadCrumbs
      links={[
        {
          href: `/${lang}/news`,
          name: getTranslation(lang, "common.breadCrumbsOptions.news"),
        },
        {
          href: `/${lang}/news/${entry.id.replace(/\\/g, "/").replace(`${lang}/`, "")}`,
          name: entry.data.title,
          isActive: true,
        },
      ]}
    />

    <article
      class="bg-white rounded-xl border border-neutral-200 shadow-sm p-6 md:p-8 mt-6"
    >
      <!-- Metadatos del artículo -->
      <div class="border-b border-neutral-200 pb-6 mb-8">
        <div class="flex flex-wrap gap-2 mb-4">
          {
            entry.data.tags?.map((tag) => (
              <span class="px-3 py-1.5 bg-emerald-100 text-emerald-700 rounded-full text-sm font-medium">
                {tag}
              </span>
            ))
          }
        </div>
        <div class="flex items-center gap-4 text-sm text-neutral-600">
          <span class="font-medium">Por {entry.data.author}</span>
          <span>•</span>
          <time
            datetime={entry.data.date.toISOString()}
            class="text-neutral-600"
          >
            {
              entry.data.date.toLocaleDateString("es-ES", {
                year: "numeric",
                month: "long",
                day: "numeric",
              })
            }
          </time>
        </div>
      </div>

      <!-- Contenido del artículo -->
      <div class="prose prose-lg max-w-none">
        <Content />
      </div>
    </article>
  </main>

  <Footer />
</MainLayout>
